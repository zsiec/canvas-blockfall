// Generated by CoffeeScript 1.4.0
(function() {
  var Tetris;

  Tetris = (function() {

    function Tetris() {}

    Tetris.prototype.start = function() {
      this.canvas = new App.Canvas();
      this.current_block = App.ShapeFactory.create('t');
      this.current_block.render(this.canvas);
      this.start_animation();
      return this.bind_keyboard_events();
    };

    Tetris.prototype.bind_keyboard_events = function() {
      var _this = this;
      return $(document).keydown(function(e) {
        if (e.keyCode === 38) {
          _this.rotate();
          return false;
        }
        if (e.keyCode === 37) {
          _this.left();
          return false;
        }
        if (e.keyCode === 39) {
          _this.right();
          return false;
        }
      });
    };

    Tetris.prototype.rotate = function() {
      this.current_block.rotate();
      return this.rerender();
    };

    Tetris.prototype.left = function() {
      this.current_block.move_left();
      return this.rerender();
    };

    Tetris.prototype.right = function() {
      this.current_block.move_right();
      return this.rerender();
    };

    Tetris.prototype.down = function() {
      this.current_block.move_down();
      return this.rerender();
    };

    Tetris.prototype.rerender = function() {
      this.canvas.clear();
      return this.current_block.render(this.canvas);
    };

    Tetris.prototype.start_animation = function() {
      return requestAnimFrame(this.tick.bind(this));
    };

    Tetris.prototype.tick = function(context) {
      var _this = this;
      return setTimeout((function() {
        _this.down();
        return requestAnimFrame(_this.tick.bind(_this));
      }), 700);
    };

    return Tetris;

  })();

  namespace("App", function(exports) {
    return exports.Tetris = Tetris;
  });

}).call(this);
